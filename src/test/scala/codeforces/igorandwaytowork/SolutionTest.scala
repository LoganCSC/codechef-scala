package codeforces.igorandwaytowork

import org.scalatest.FunSuite


class SolutionTest extends FunSuite {

  val bfsSolver = new BfsSolver
  val dfsSolver = new DfsSolver

  def makeData(n: Int): Array[String] = (for (i <- 1 to n) yield  Array.fill(n)(" ").mkString).toArray

  test("Simple 3x3") {
    verify(Seq(
      ".S..",
      "***.",
      ".T.."), true)
  }

  test("Simple 3x3 (unsolvable)") {
    verify(Seq(
      ".S..",
      "****",
      ".T.."), false)
  }

  test("Simple 5x5") {
    verify(Seq(
      "..S..",
      "****.",
      "T....",
      "****.",
      "....."), true)
  }

  test("Simple 5x5 (unsolvable)") {
    verify(Seq(
      "..S..",
      "****.",
      ".....",
      ".****",
      "..T.."), false)
  }

  test("Simple 7x7 ") {
    verify(Seq(
      ".S.****",
      "...*.*.",
      ".****..",
      ".*.**.*",
      "..T*...",
      "***..*.",
      "*******"), true)
  }

  test("huge 1000x1000 ") {
    var data = makeData(1000)
    data(3) = data(3).substring(0, 700) + "S" + data(3).substring(701)
    data(800) = data(800).substring(0, 100) + "T" + data(800).substring(101)
    verify(data, true)
  }

  test("huge 1000x1000 (unsolvable)") {
    var data = makeData(1000)
    data(800) = data(800).substring(0, 100) + "S" + data(800).substring(101)
    data(500) = Array.fill(500)("*").mkString + data(500).substring(500)
    data(502) = data(502).substring(0, 5) + Array.fill(995)("*").mkString
    data(3) = data(3).substring(0, 700) + "T" + data(3).substring(701)
    verify(data, false)
  }

  test("huge 5000x5000 ") {
    var data = makeData(5000)
    data(3) = data(3).substring(0, 3500) + "S" + data(3).substring(3501)
    data(4000) = data(4000).substring(0, 500) + "T" + data(4000).substring(501)
    verify(data, true)
  }

  test("huge 5000x5000 (unsolvable)") {
    var data = makeData(5000)
    data(4000) = data(4000).substring(0, 1000) + "S" + data(4000).substring(501)
    data(2500) = Array.fill(2500)("*").mkString + data(2500).substring(500)
    data(2502) = data(2502).substring(0, 5) + Array.fill(4995)("*").mkString
    data(3) = data(3).substring(0, 3500) + "T" + data(3).substring(3501)
    verify(data, false)
  }

  test("Large 100x100 ") {
    verify(Seq(
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*.....................................................S....................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*............................................................................................**",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*.....................................................................*....................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................*...............................................................****",
      "...*..........................T...............................................................****",
      "...*..........................................................................................**..",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*........................................................................................S.****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*............................*.............................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****"),
      true)
  }

  test("Large 100x100 (unsolvable)") {
    verify(Seq(
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*................................................S........................*................****",
      "...*...........................................*..........*...................................****",
      "...*...............................................*.*........................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*............................................................................................**",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*.....................................................................*....................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*.............................................******.......................................****",
      "...*.........................***....................*.........................................****",
      "...*.......................**.T.**............................................................****",
      "...*..........................................................................................**..",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*........................................................................................S.****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*............................*.............................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****"),
      false)
  }

  test("Large tricky 100x100 (solvable)") {
    verify(Seq(
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*................................................S........................*................****",
      "...*...........................................*..........*...................................****",
      "...*...............................................*.*........................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*............................................................................................**",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*.....................................................................*....................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*.............................................******.......................................****",
      "...*.........................***....................*.........................................****",
      "...*..........*...............T...............................................................****",
      "...*..........................................................................................**..",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*........................................................................................S.****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*............................*.............................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****",
      "...*..........................................................................................****"),
      true)
  }


  def verify(data: Seq[String], expectedResult: Boolean): Unit = {
    val map = new CityMap(data)

    val startTime = System.currentTimeMillis()
    val bfsSolvable = bfsSolver.isSolvable(map)
    println("bfs solve time = " + (System.currentTimeMillis() - startTime) + " solved = " + bfsSolvable)

    val startTime2 = System.currentTimeMillis()
    val dfsSolvable = dfsSolver.isSolvable(map)
    println("dfs solve time = " + (System.currentTimeMillis() - startTime2)+ " solved = " + dfsSolvable)

    assertResult(expectedResult, "bfs") {bfsSolvable}
    assertResult(expectedResult, "dfs") {dfsSolvable}
  }
}